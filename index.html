<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego del Impostor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-theme {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            text-align: center;
            width: 100%;
            max-width: 500px;
            position: relative;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-theme .container {
            background: #2d2d2d;
            color: #ffffff;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }

        button {
            padding: 15px 30px;
            margin: 10px 0;
            font-size: 18px;
            width: 100%;
            max-width: 200px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        body.dark-theme button {
            background-color: #388E3C;
        }

        body.dark-theme button:hover {
            background-color: #2E7D32;
        }

        .player-status {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #e8f5e8;
            padding: 10px 15px;
            border-radius: 8px;
            border: 2px solid #2e7d32;
            font-weight: bold;
            display: none;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-theme .player-status {
            background: #1b5e20;
            color: #ffffff;
            border-color: #4caf50;
        }

        .code-input, .number-input {
            padding: 12px;
            font-size: 18px;
            width: 250px;
            text-align: center;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            margin: 20px 0;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        .code-input {
            text-transform: uppercase;
        }

        .number-input {
            width: 100px;
        }

        body.dark-theme .code-input,
        body.dark-theme .number-input {
            background-color: #3d3d3d;
            color: #ffffff;
            border-color: #4CAF50;
        }

        .result {
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.2em;
            transition: background-color 0.3s, color 0.3s;
        }

        .impostor {
            background-color: #ffebee;
            color: #c62828;
            border: 3px solid #c62828;
        }

        body.dark-theme .impostor {
            background-color: #4a1a1a;
            color: #ff6b6b;
            border-color: #ff6b6b;
        }

        .inocente {
            background-color: #e8f5e8;
            color: #2e7d32;
            border: 3px solid #2e7d32;
        }

        body.dark-theme .inocente {
            background-color: #1b3a1b;
            color: #66bb6a;
            border-color: #66bb6a;
        }

        .hidden {
            display: none;
        }

        .player-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            transition: color 0.3s;
        }

        body.dark-theme h1 {
            color: #ffffff;
        }

        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196F3;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-theme .instructions {
            background: #1a237e;
            color: #ffffff;
            border-left-color: #5c6bc0;
        }

        .code-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #2196F3;
            margin: 15px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
            border: 2px dashed #2196F3;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-theme .code-display {
            background: #1a237e;
            color: #90caf9;
            border-color: #5c6bc0;
        }

        /* Bot√≥n de tema oscuro */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #4CAF50;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        body.dark-theme .theme-toggle {
            background: #388E3C;
        }

        .theme-toggle::before {
            content: "üåô";
        }

        body.dark-theme .theme-toggle::before {
            content: "‚òÄÔ∏è";
        }
    </style>
</head>
<body>
    <!-- Bot√≥n de tema oscuro -->
    <button class="theme-toggle" onclick="toggleTheme()"></button>

    <div class="container">
        <!-- Estado de jugadores listos -->
        <div id="player1Status" class="player-status">Jugador 1 Listo</div>
        <div id="player2Status" class="player-status">Jugador 2 Listo</div>
        <div id="player3Status" class="player-status">Jugador 3 Listo</div>
        <div id="player4Status" class="player-status">Jugador 4 Listo</div>

        <!-- Paso 1: Bot√≥n Empezar -->
        <div id="stepStart">
            <h1>üéÆ Juego del Impostor</h1>
            <button onclick="startGame()">Empezar</button>
        </div>

        <!-- Paso 2: Selecci√≥n de jugador -->
        <div id="stepPlayerSelect" class="hidden">
            <h1>Selecciona tu jugador</h1>
            <div class="player-buttons">
                <button onclick="selectPlayer(1)">Jugador 1</button>
                <button onclick="selectPlayer(2)">Jugador 2</button>
                <button onclick="selectPlayer(3)">Jugador 3</button>
                <button onclick="selectPlayer(4)">Jugador 4</button>
            </div>
        </div>

        <!-- Paso 3: Para Jugador 1 - Seleccionar n√∫mero de jugadores -->
        <div id="stepPlayerCount" class="hidden">
            <h1>Configurar Partida</h1>
            <div class="instructions">
                <p>üéØ <strong>Jugador 1 - Configura la partida</strong></p>
                <p>¬øCu√°ntos jugadores van a jugar?</p>
            </div>
            <input type="number" id="totalPlayers" class="number-input" min="3" max="10" value="4">
            <br>
            <button onclick="setPlayerCount()">Crear Partida</button>
        </div>

        <!-- Paso 4: Input c√≥digo de partida -->
        <div id="stepCodeInput" class="hidden">
            <h1>Unirse a partida</h1>
            
            <div id="createCodeSection" class="hidden">
                <div class="instructions">
                    <p>üìù <strong>Instrucciones para el Jugador 1:</strong></p>
                    <p>1. Comparte este c√≥digo con los dem√°s jugadores</p>
                    <p>2. Despu√©s pulsa "Unirme a esta Partida"</p>
                </div>
                
                <div id="codeDisplay">
                    <p>¬°Partida creada! Comparte este c√≥digo:</p>
                    <div id="gameCode" class="code-display"></div>
                    <button onclick="joinWithCreatedCode()">Unirme a esta Partida</button>
                </div>
            </div>

            <div id="joinCodeSection">
                <div class="instructions">
                    <p><strong>Para los dem√°s jugadores:</strong></p>
                    <p>Ingresa el c√≥digo que te comparti√≥ el Jugador 1:</p>
                </div>
                <input type="text" id="inputCode" class="code-input" placeholder="Ej: 986NASFGD" maxlength="30">
                <br>
                <button onclick="joinGame()">Unirse con C√≥digo</button>
            </div>
        </div>

        <!-- Paso 5: Mostrar resultado -->
        <div id="stepResult" class="hidden">
            <h1>Tu rol es:</h1>
            <div id="result" class="result"></div>
            <button onclick="resetGame()">Volver a Jugar</button>
        </div>
    </div>

    <script>
        // M√ÅS DE 100 PALABRAS SECRETAS - 3 categor√≠as ampliadas
        const palabras = [
            // CATEGOR√çA 1: ANIMALES Y NATURALEZA (35 palabras)
            "elefante", "dinosaurio", "jirafa", "delf√≠n", "mariposa", 
            "camale√≥n", "koala", "pinguino", "armadillo", "ornitorrinco",
            "leopardo", "canguro", "flamenco", "panda", "tuc√°n",
            "ballena", "pulpo", "ardilla", "erizo", "murci√©lago",
            "cebra", "hipop√≥tamo", "rinoceronte", "gorila", "chimpanc√©",
            "√°guila", "b√∫ho", "colibr√≠", "pavo real", "cisne",
            "cocodrilo", "serpiente", "tortuga", "rana", "salamandra",

            // CATEGOR√çA 2: OBJETOS Y TECNOLOG√çA (35 palabras)
            "bicicleta", "guitarra", "tel√©fono", "robot", "cohete",
            "paraguas", "br√∫jula", "telescopio", "meg√°fono", "tambor",
            "computadora", "teclado", "auriculares", "dron", "sat√©lite",
            "c√°mara", "micr√≥fono", "altavoz", "proyector", "impresora",
            "reloj", "espejo", "linterna", "maleta", "sombrilla",
            "martillo", "destornillador", "llave", "candado", "cuerda",
            "globo", "cometa", "yoyo", "rompecabezas", "domin√≥",

            // CATEGOR√çA 3: FANTAS√çA Y AVENTURA (35 palabras)
            "pirata", "sirena", "astronauta", "superh√©roe", "drag√≥n",
            "magia", "tesoro", "misterio", "aventura", "fantas√≠a",
            "hechicero", "caballero", "bruja", "hada", "duende",
            "unicornio", "fenix", "grifo", "quimera", "minotauro",
            "castillo", "fortaleza", "palacio", "templo", "pir√°mide",
            "espada", "escudo", "armadura", "corona", "anillo",
            "mapa", "br√∫jula", "bot√≠n", "medall√≥n", "gema"
        ];

        // Sistema de memoria para evitar repeticiones recientes
        let palabrasUsadasRecientemente = [];
        const MAX_PALABRAS_RECIENTES = 15;

        // Sistema para llevar cuenta de qui√©n ha sido impostor
        let historialImpostores = [];
        const MAX_HISTORIAL = 10;

        let jugadorSeleccionado = 0;
        let totalJugadoresPartida = 4;
        let gameConfig = {
            palabraSecreta: "",
            jugadorImpostor: 0,
            codigo: ""
        };

        // Funci√≥n para cambiar entre temas
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            // Guardar preferencia en localStorage
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('darkTheme', isDark);
        }

        // Cargar tema al iniciar
        function loadTheme() {
            const savedTheme = localStorage.getItem('darkTheme');
            if (savedTheme === 'true') {
                document.body.classList.add('dark-theme');
            }
        }

        // Llamar al cargar la p√°gina
        loadTheme();

        // Funci√≥n para obtener una palabra que no se haya usado recientemente
        function obtenerPalabraAleatoria() {
            let palabra;
            let intentos = 0;
            const maxIntentos = 30;
            
            do {
                palabra = palabras[Math.floor(Math.random() * palabras.length)];
                intentos++;
                
                if (intentos > maxIntentos) {
                    palabrasUsadasRecientemente = [];
                    break;
                }
            } while (palabrasUsadasRecientemente.includes(palabra));
            
            palabrasUsadasRecientemente.push(palabra);
            
            if (palabrasUsadasRecientemente.length > MAX_PALABRAS_RECIENTES) {
                palabrasUsadasRecientemente.shift();
            }
            
            return palabra;
        }

        // Funci√≥n MEJORADA para seleccionar impostor de forma m√°s justa
        function seleccionarImpostorJusto(codigoCompleto, totalJugadores) {
            // Crear un hash m√°s robusto del c√≥digo
            let hash = 0;
            for (let i = 0; i < codigoCompleto.length; i++) {
                const char = codigoCompleto.charCodeAt(i);
                hash = ((hash << 7) - hash) + char;
                hash = hash & hash; // Convertir a 32-bit integer
            }
            
            // Usar el hash absoluto para calcular el impostor
            const impostor = Math.abs(hash) % totalJugadores + 1;
            
            return impostor;
        }

        // Funci√≥n para codificar una palabra a un c√≥digo de letras
        function codificarPalabra(palabra) {
            const letras = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let codigo = '';
            let suma = 0;
            
            for (let i = 0; i < 6; i++) {
                const indicePalabra = i % palabra.length;
                const charCode = palabra.charCodeAt(indicePalabra);
                suma += charCode;
                
                const indiceLetra = (charCode + i + suma) % 26;
                codigo += letras[indiceLetra];
            }
            return codigo;
        }

        // Funci√≥n para decodificar el c√≥digo a la palabra original
        function decodificarPalabra(codigo) {
            // Buscar la palabra en la lista que mejor coincida con el c√≥digo
            for (let palabra of palabras) {
                const codigoGenerado = codificarPalabra(palabra);
                if (codigoGenerado === codigo) {
                    return palabra;
                }
            }
            
            // Si no encuentra coincidencia exacta, buscar la m√°s similar
            let mejorPalabra = palabras[0];
            let mejorPuntuacion = 0;
            
            for (let palabra of palabras) {
                const codigoGenerado = codificarPalabra(palabra);
                let puntuacion = 0;
                
                for (let i = 0; i < codigo.length; i++) {
                    if (codigoGenerado[i] === codigo[i]) {
                        puntuacion++;
                    }
                }
                
                if (puntuacion > mejorPuntuacion) {
                    mejorPuntuacion = puntuacion;
                    mejorPalabra = palabra;
                }
            }
            
            return mejorPalabra;
        }

        function startGame() {
            document.getElementById('stepStart').classList.add('hidden');
            document.getElementById('stepPlayerSelect').classList.remove('hidden');
        }

        function selectPlayer(numero) {
            jugadorSeleccionado = numero;
            
            // Mostrar el estado del jugador seleccionado
            document.getElementById(`player${numero}Status`).style.display = 'block';
            
            // Ocultar selecci√≥n de jugador
            document.getElementById('stepPlayerSelect').classList.add('hidden');
            
            if (numero === 1) {
                // Si es Jugador 1, mostrar configuraci√≥n de n√∫mero de jugadores
                document.getElementById('stepPlayerCount').classList.remove('hidden');
            } else {
                // Si es otro jugador, mostrar directamente la pantalla de c√≥digo
                document.getElementById('stepCodeInput').classList.remove('hidden');
                document.getElementById('createCodeSection').classList.add('hidden');
                document.getElementById('joinCodeSection').classList.remove('hidden');
            }
        }

        function setPlayerCount() {
            const count = parseInt(document.getElementById('totalPlayers').value);
            
            if (count < 3 || count > 10 || isNaN(count)) {
                alert("Por favor, introduce un n√∫mero entre 3 y 10");
                return;
            }
            
            totalJugadoresPartida = count;
            
            // Crear el c√≥digo de partida autom√°ticamente
            createGameCode();
        }

        function createGameCode() {
            // Elegir palabra aleatoria (evitando repeticiones recientes)
            const palabraSecreta = obtenerPalabraAleatoria();
            
            // Codificar la palabra
            const codigoPalabra = codificarPalabra(palabraSecreta);
            
            // Generar n√∫mero aleatorio para el c√≥digo (100-999)
            const numeroCodigo = Math.floor(Math.random() * 900) + 100;
            
            // Crear c√≥digo final: "986NASFGD"
            const codigoCompleto = numeroCodigo + codigoPalabra;
            
            // Determinar impostor usando el sistema MEJORADO
            const jugadorImpostor = seleccionarImpostorJusto(codigoCompleto, totalJugadoresPartida);

            // Guardar configuraci√≥n
            gameConfig.palabraSecreta = palabraSecreta;
            gameConfig.jugadorImpostor = jugadorImpostor;
            gameConfig.codigo = codigoCompleto;

            // Ocultar configuraci√≥n y mostrar c√≥digo
            document.getElementById('stepPlayerCount').classList.add('hidden');
            document.getElementById('stepCodeInput').classList.remove('hidden');
            document.getElementById('createCodeSection').classList.remove('hidden');
            document.getElementById('joinCodeSection').classList.add('hidden');
            
            // Mostrar el c√≥digo
            document.getElementById('gameCode').textContent = gameConfig.codigo;
        }

        function joinWithCreatedCode() {
            // El Jugador 1 se une a su propia partida creada
            showResult();
        }

        function joinGame() {
            const inputCode = document.getElementById('inputCode').value.toUpperCase().trim();
            
            if (inputCode.length < 9) {
                alert("C√≥digo inv√°lido. Debe tener al menos 9 caracteres (ej: 986NASFGD)");
                return;
            }

            // Extraer n√∫mero y c√≥digo de letras
            const numeroCodigo = inputCode.substring(0, 3);
            const codigoPalabra = inputCode.substring(3, 9);

            // Verificar que los primeros 3 caracteres sean n√∫meros
            if (!/^\d+$/.test(numeroCodigo)) {
                alert("C√≥digo inv√°lido. Los primeros 3 caracteres deben ser n√∫meros");
                return;
            }

            // Decodificar la palabra secreta
            const palabraSecreta = decodificarPalabra(codigoPalabra);
            
            // Para jugadores que no son el 1, necesitamos determinar el total de jugadores
            // Podemos estimarlo basado en el c√≥digo o usar un valor por defecto
            const totalJugadores = totalJugadoresPartida || 4;
            
            // Determinar impostor usando el sistema MEJORADO
            const jugadorImpostor = seleccionarImpostorJusto(inputCode, totalJugadores);

            // Guardar configuraci√≥n
            gameConfig.palabraSecreta = palabraSecreta;
            gameConfig.jugadorImpostor = jugadorImpostor;
            gameConfig.codigo = inputCode;

            showResult();
        }

        function showResult() {
            // Ocultar input y mostrar resultado
            document.getElementById('stepCodeInput').classList.add('hidden');
            document.getElementById('stepResult').classList.remove('hidden');
            
            const resultado = document.getElementById('result');
            
            if (jugadorSeleccionado === gameConfig.jugadorImpostor) {
                resultado.innerHTML = `
                    <h2>üé≠ IMPOSTOR</h2>
                    <p>No conoces la palabra secreta</p>
                    <p><small>Debes adivinar o no ser descubierto</small></p>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666;">C√≥digo: ${gameConfig.codigo}</p>
                    <p style="font-size: 0.9em; color: #666;">Jugadores: ${totalJugadoresPartida}</p>
                `;
                resultado.className = 'result impostor';
            } else {
                resultado.innerHTML = `
                    <h2>‚úÖ INOCENTE</h2>
                    <p>La palabra secreta es:</p>
                    <h1 style="font-size: 1.8em; margin: 10px 0;">"${gameConfig.palabraSecreta}"</h1>
                    <p><small>Da pistas relacionadas con esta palabra</small></p>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666;">C√≥digo: ${gameConfig.codigo}</p>
                    <p style="font-size: 0.9em; color: #666;">Jugadores: ${totalJugadoresPartida}</p>
                `;
                resultado.className = 'result inocente';
            }
        }

        function resetGame() {
            // Ocultar todos los estados de jugadores
            document.getElementById('player1Status').style.display = 'none';
            document.getElementById('player2Status').style.display = 'none';
            document.getElementById('player3Status').style.display = 'none';
            document.getElementById('player4Status').style.display = 'none';
            
            // Ocultar resultado y mostrar selecci√≥n de jugador
            document.getElementById('stepResult').classList.add('hidden');
            document.getElementById('stepPlayerSelect').classList.remove('hidden');
            
            // Resetear variables
            jugadorSeleccionado = 0;
            totalJugadoresPartida = 4;
            gameConfig = { 
                palabraSecreta: "", 
                jugadorImpostor: 0, 
                codigo: "" 
            };
            
            // Resetear inputs
            document.getElementById('totalPlayers').value = '4';
            document.getElementById('inputCode').value = '';
        }

        // Permitir usar Enter en los inputs
        document.getElementById('totalPlayers').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                setPlayerCount();
            }
        });

        document.getElementById('inputCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                joinGame();
            }
        });
    </script>
</body>
</html>
